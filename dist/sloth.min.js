!function(t,i){"function"==typeof define&&define.amd?define([],i):"object"==typeof exports?module.exports=i():t.Sloth=i()}(this,function(){"use strict";function t(i,e){if("undefined"==typeof i)throw"Cannot initialize Sloth, no element given.";this.settings=$.extend({},t.defaultSettings,e||{}),this.$element=i,this.isInline="img"===this.$element[0].tagName.toLowerCase(),this.initialWidth=0,this.initialHeight=0,this.width=0,this.init().bind()}function i(t){var i=this.$element.attr("data-src").split("/");return"string"!=typeof t?i.join("/"):(5===i.length?i[4]=t:i.push(t),i.join("/"))}function e(t,i){this.constructor.call(this,t,i)}function s(t,i){this.constructor.call(this,t,i)}var n={};n.Base=t,t.prototype.init=function(){return this.parseOptions(),this.calculateDimensions(),this.parseSource(),this.wrap(),this.preload($.proxy(this.onLoad,this)),this},t.prototype.preload=function(t){var i=$(new Image);i.hide().appendTo($(document.body)).on("load",function(){t(i),i.remove()}).on("error",$.proxy(this.onError,this)).attr("src",this.source)},t.prototype.onLoad=function(){},t.prototype.onError=function(){},t.prototype.parseSource=function(){var t,i=window.devicePixelRatio||window.webkitDevicePixelRatio||window.mozDevicePixelRatio;i="undefined"==typeof i?1:parseFloat(i);for(var e in this.settings.versions)if(this.settings.versions.hasOwnProperty(e)){var s=this.settings.versions[e];if(!(this.initialWidth>parseInt(e,10)))break;t=s}this.source=this.getSource(t),i>1&&this.settings.retina&&(this.source+=this.settings.retina)},t.prototype.getSource=function(t){var i,e,s;return i=this.$element,s=this.settings.sourceGetterFunction,s&&(e=s.call(this,t)),e&&e.length||(e=i.attr("data-src-"+t)),e&&e.length||(e=i.attr("data-src")),e},t.prototype.parseOptions=function(){if(this.$element.attr("data-ratio")){var t=this.$element.attr("data-ratio").split(":"),i=parseInt(t[0],10),e=t[1]?parseInt(t[1],10):1;this.ratio=i/e}else this.ratio=this.settings.ratio},t.prototype.calculateDimensions=function(){this.initialWidth=parseInt(this.$element.css("width"),10),this.initialHeight=this.initialWidth*(1/this.ratio),this.width=""!==this.$element.get(0).style.width?this.$element.get(0).style.width:this.initialWidth},t.prototype.wrap=function(){return this},t.prototype.bind=function(){return this},t.prototype.unbind=function(){return this},t.defaultSettings={versions:{220:"small",640:"medium",1280:"large"},retina:"",ratio:16/9,sourceGetterFunction:i},t.load=function(t,i){$(t).each(function(){"img"===this.tagName.toLowerCase()?new n.Inline($(this),i):new n.Background($(this),i)})};var n=n||{};e.prototype=$.extend({},n.Base.prototype),e.prototype.constructor=n.Base,n.Background=e,e.prototype.onLoad=function(t){var i=this.$element;i.find(".sloth__background").css("background-image",'url("'+t.attr("src")+'")').fadeIn(880,function(){i.removeClass("is-loading")})},e.prototype.onError=function(){this.$element.removeClass("is-loading").addClass("is-errored");try{console.error("Could not load",this.source)}catch(t){}},e.prototype.wrap=function(){var t=$('<div class="sloth__background" />'),i={background:this.$element.css("background"),"background-style":this.$element.css("background-style")};if(this.$element.addClass("sloth is-loading"),("static"===this.$element.css("position")||"relative"===this.$element.css("position"))&&this.$element.css("position","relative"),this.$element.html().length>0){var e=$('<div class="sloth__content"></div>'),s={position:"relative","z-index":2};$(document.body).append(e),("absolute"===e.css("position")||"fixed"===e.css("position"))&&(s.position=e.css("position")),"auto"!==e.css("z-index")&&(s["z-index"]=e.css("z-index")),e.remove(),e=null,this.$element.wrapInner($('<div class="sloth__content" />').css(s))}if(""===i.background){delete i.background;for(var n=["background-size","background-repeat","background-position","background-origin","background-clip","background-color"],o=0;o<n.length;o++){var r=n[o];i[r]=this.$element.css(r)}}t.css({position:"absolute",top:0,left:0,right:0,bottom:0,"z-index":1}).css(i).hide().appendTo(this.$element)};var n=n||{};return s.prototype=$.extend({},n.Base.prototype),s.prototype.constructor=n.Base,n.Inline=s,s.prototype.onLoad=function(t){var i,e,s=this.$element.closest(".sloth");s.css("width",this.width),i=this.initialWidth/t.width()*t.height(),e=this.width/i==1?"is-square":this.width/i<1?"is-portrait":"is-landscape",this.$element.hide().attr("src",t.attr("src")).fadeIn(880,function(){s.removeClass("is-loading")}),s.addClass(e).animate({height:i},220,function(){s.css("height","")})},s.prototype.onError=function(){var t=this.$element.closest(".sloth");t.removeClass("is-loading").addClass("is-errored");try{console.error("Could not load",this.source)}catch(i){}},s.prototype.calculateDimensions=function(){var t=(this.$element.parent(),parseInt(this.$element.css("width"),10));t?(this.initialWidth=this.width=t,""!==this.$element.get(0).style.width&&(this.width=this.$element.get(0).style.width)):(this.initialWidth=this.width=parseInt(this.$element.parent().css("width")),"none"!==this.$element.css("max-width")&&(this.width="")),this.initialHeight=this.initialWidth*(1/this.ratio)},s.prototype.wrap=function(){var t,i=$('<span class="sloth is-loading" />');t={width:this.initialWidth,height:this.initialHeight,display:"inline-block","font-size":0},"none"!==this.$element.css("max-width")&&$.extend(t,{"max-width":this.$element.css("max-width")}),i.css(t),this.$element.css({display:"block",width:"100%",position:"relative","z-index":2}),this.$element.wrap(i)},n});