!function(t,i){"function"==typeof define&&define.amd?define([],i):"object"==typeof exports?module.exports=i():t.Sloth=i()}(this,function(){"use strict";function t(e){return"undefined"==typeof e?void i("Cannot initialize Sloth, no element given."):(t.settings=t.settings||t.defaultSettings,this.$element=e,this.isInline="img"===this.$element[0].tagName.toLowerCase(),this.initialWidth=0,this.initialHeight=0,this.width=0,void this.init().bind())}function i(t){window.console&&window.console.error&&console.error(t)}function e(t){var i=this.$element.attr("data-src").split("/");return 5==i.length?i[4]=t:i.push(t),i.join("/")}function n(t,i){this.constructor.call(this,t,i)}function s(t,i){this.constructor.call(this,t,i)}var o={};return o.Base=t,t.prototype.init=function(){return this.parseOptions(),this.calculateDimensions(),this.parseSource(),this.wrap(),this.preload($.proxy(this.onLoad,this)),this},t.prototype.preload=function(t){var i=$(new Image);i.hide().appendTo($(document.body)).on("load",function(){t(i),i.remove()}).on("error",$.proxy(this.onError,this)).attr("src",this.source)},t.prototype.onLoad=function(){},t.prototype.onError=function(){},t.prototype.parseSource=function(){var i,e=window.devicePixelRatio||window.webkitDevicePixelRatio||window.mozDevicePixelRatio;e="undefined"==typeof e?1:parseFloat(e);for(var n in t.settings.versions)if(t.settings.versions.hasOwnProperty(n)){var s=t.settings.versions[n];if(!(this.initialWidth>parseInt(n,10)))break;i=s}this.source=this.getSource(i),e>1&&t.settings.retina&&(this.source+=t.settings.retina)},t.prototype.getSource=function(i){var e,n,s;return e=this.$element,s=t.settings.sourceGetterFunction,s&&(n=s.call(this,i)),n&&n.length||(n=e.attr("data-src-"+i)),n&&n.length||(n=e.attr("data-src")),n},t.prototype.parseOptions=function(){if(this.$element.attr("data-ratio")){var i=this.$element.attr("data-ratio").split(":"),e=parseInt(i[0],10),n=i[1]?parseInt(i[1],10):1;this.ratio=e/n}else this.ratio=t.settings.ratio},t.prototype.calculateDimensions=function(){this.initialWidth=parseInt(this.$element.css("width"),10),this.initialHeight=this.initialWidth*(1/this.ratio),this.width=""!==this.$element.get(0).style.width?this.$element.get(0).style.width:this.initialWidth},t.prototype.wrap=function(){return this},t.prototype.bind=function(){return this},t.prototype.unbind=function(){return this},t.defaultSettings={versions:{220:"small",640:"medium",1280:"large"},retina:"",ratio:16/9,sourceGetterFunction:e},t.extendFromDefaultSettings=function(i){return $.extend({},t.defaultSettings,i||{})},t.load=function(t){$(t).each(function(){"img"===this.tagName.toLowerCase()?new o.Inline($(this)):new o.Background($(this))})},n.prototype=$.extend({},o.Base.prototype),n.prototype.constructor=o.Base,o.Background=n,n.prototype.onLoad=function(t){var i=this.$element;i.find(".sloth__background").css("background-image","url("+t.attr("src")+")").fadeIn(880,function(){i.removeClass("is-loading")})},n.prototype.onError=function(){this.$element.removeClass("is-loading").addClass("is-errored");try{console.error("Could not load",this.source)}catch(t){}},n.prototype.wrap=function(){var t=$('<div class="sloth__background" />'),i={background:this.$element.css("background"),"background-style":this.$element.css("background-style")};if(this.$element.addClass("sloth is-loading"),("static"===this.$element.css("position")||"relative"===this.$element.css("position"))&&this.$element.css("position","relative"),this.$element.html().length>0&&this.$element.wrapInner($('<div class="sloth__content" />').css({position:"relative","z-index":2})),""===i.background){delete i.background;for(var e=["background-size","background-repeat","background-position","background-origin","background-clip","background-color"],n=0;n<e.length;n++){var s=e[n];i[s]=this.$element.css(s)}}t.css({position:"absolute",top:0,left:0,right:0,bottom:0,"z-index":1}).css(i).hide().appendTo(this.$element)},s.prototype=$.extend({},o.Base.prototype),s.prototype.constructor=o.Base,o.Inline=s,s.prototype.onLoad=function(t){var i,e=this.$element.closest(".sloth");e.css("width",this.width),this.$element.hide().attr("src",t.attr("src")).fadeIn(880,function(){e.removeClass("is-loading")}),i=this.initialWidth/t.width()*t.height(),e.animate({height:i},220,function(){e.css("height","")})},s.prototype.onError=function(){var t=this.$element.closest(".sloth");t.removeClass("is-loading").addClass("is-errored");try{console.error("Could not load",this.source)}catch(i){}},s.prototype.calculateDimensions=function(){var t=(this.$element.parent(),parseInt(this.$element.css("width"),10));t?(this.initialWidth=t,this.width=""!==this.$element.get(0).style.width?this.$element.get(0).style.width:this.initialWidth):(this.initialWidth=parseInt(this.$element.parent().css("width")),this.width=this.initialWidth,"none"!==this.$element.css("max-width")&&(this.width="")),this.initialHeight=this.initialWidth*(1/this.ratio)},s.prototype.wrap=function(){var t=$('<span class="sloth is-loading" />');t.css({width:this.initialWidth,height:this.initialHeight,display:"inline-block","max-width":this.$element.css("max-width"),"font-size":0}),this.$element.css({display:"block",width:"100%",position:"relative","z-index":2}),this.$element.wrap(t)},o});